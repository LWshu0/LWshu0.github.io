---
title: 关系数据库
copyright: true
date: 2023-09-10 23:09:05
updated: 2023-10-12 23:09:05
tags:
    - 数据库
    - 课程笔记
categories:
    - 数据库
    - 课程学习笔记
excerpt: 关系数据库的基本概念, 主要包括一些关系运算的定义.
#index_img:
#banner_img:
---
# 关系数据库

关系, 用一张**表**表示, 关系数据库就是这样的表的集合. 其中表的每一行叫做**元组**(是一个关系实例), 表的每一列叫做一个**属性**, 属性的取值范围是**域**, 属性是原子的不可拆分.

## 键/码

**超码**可以唯一区分一个实例的一个或多个属性(允许这些属性中有多余的属性), 最小的超码叫做**候选码**, 从候选码中选中的叫做**主码(primary key)**.

表或者说关系$r_1$中存在$r_2$的主码, 那么$r_1$中的这一个或多个码叫做**外码(foreign key)**. 其中$r_1$称为参照关系, $r_2$称为被参照关系.

## 关系运算

### 基本运算符

一共有六个:

1. $\sigma$, 选择
2. $\Pi$, 投影
3. $\bigcup$, 集合并
4. $-$, 集合差
5. $\times$, 笛卡尔积
6. $\rho$, 重命名

**详解**

#### 选择

$\sigma_{A}(R)$ 返回关系R中满足条件A的关系, 其中A可以是等式/不等式, 还可用与($\wedge$)或($\vee$)非($\neg$)链接多个等式或不等式.

例如: 关系数据库$employee=(ID, name, age, salary)$, 选择其中薪资大于3000同时年龄小于30的员工的所有信息

$$
\sigma_{salary>3000 \wedge age<30}(employee)
$$

#### 投影

$\Pi_{A_1, A_2, \cdots}(R)$选中关系R中的$A_1$, $A_2$等属性并返回该关系, 同时对关系进行去重. 当选择的属性中有主码时, 说明每一行的实例都是独一无二的则不会有去重的过程.

例如: 上面的employee数据库, 返回所有人的ID与姓名:

$$
\Pi_{ID, name}(employee)
$$

#### 集合并

$R_1 \bigcup R_2$必须保证$R_1$和$R_2$有完全相同的属性(包括属性名和属性的数据类型), 返回一个有两个关系构成的新的关系.

#### 集合差

$R_1 - R_2$与集合并的要求一致

#### 笛卡尔积

$R_1 \times R_2$, 将关系$R_1$与关系$R_2$每一项组合并返回一个新的关系. 假设$R_1$有x个属性, m行, $R_2$有y个属性, n行, 那么$R_1 \times R_2$返回的关系将有$(x+y)$个属性和$mn$行

#### 重命名

$\rho_{X}(R)$把关系R重命名为X

### 附加的运算符

#### 自然连接

$R \bowtie S$等价于将R和S做笛卡尔积并选择其中的重复的属性相同的行(同时完全相同的列只保留一个)

例如, $employee=(ID, name, age, salary)$ , $works=(ID, company)$ , 其中两个ID是相同的含义都是唯一区分员工的码, 是employee中的主码, 是works中的外码.

那么, $employee \bowtie works = (ID, name, age, salary, company)$

#### theta链接

$R \bowtie_{\theta} S$, 是自然连接的自定义版本, 等价于 $\sigma_{\theta}(R \times S)$, 其中 $\theta$ 是关系谓词.

#### 临时赋值

$TEMP \leftarrow \omega$ 将 $\omega$ 赋值给变量 $TEMP$ , 其中 $\omega$ 可以是一个关系表达式返回关系

#### 集合交

定义: $r \cap s = r - (r-s)$ , 其中 $r, s$ 为相同类型的关系

#### 外连接

分为左外连接, 右外连接, 全外连接.

将运算符左边的表称为左表, 右边的称为右表, 对于左外连接而言, 当右表中不存在左表的对应元组时, 将用 $null$ 填充, **左表的数据将全部保留, 不会有丢失**. 右外连接保留右表, 全外连接两个表都保留.

### 扩展到关系代数运算

#### 广义投影

允许在投影运算的投影列表中使用算术运算和字符串函数来对投影进行拓展, 比如对数值属性或产生的数值结果进行 $+,-,*,/$ 等代数运算, 例如: $\Pi_{ID, name, dept\_name, salary/12}(instructor)$

#### 聚集

聚集函数: **sum, count, min, max**, 还可以使用 **distinct** 修饰聚集函数, 表示去重后再聚集.

聚集运算的形式:

$$
\ _{G_1, G_2, \dots, G_n}\mathcal{G}_{F_1(A_1), F_2(A_2), \dots, F_n(A_n)}(E)
$$

其中, $E$ 为任意的关系代数表达式, $G_i$ 是用于分组的属性(可以为空的, 即不添加任何分组属性), $F_i$ 是一个聚集函数, $A_i$ 是属性名.

### 关系运算优先级

1. $\rho ,\ \Pi ,\ \sigma$
2. $\times ,\ \bowtie$
3. $\bigcap$
4. $\bigcup ,\ -$
